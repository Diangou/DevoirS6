<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Pok√©dex</title>
    <link data-favicon rel="shortcut icon" href="/favicon.png" type="image/png">
    <link href="../src/styles/main.css" rel="stylesheet">
</head>
<body>
    <header class="py-2 bg-slate-900 text-white">
        <div class="mr-[max(env(safe-area-inset-right),_theme(space.3))] ml-[max(env(safe-area-inset-left),_theme(space.3))]">
            <div class="flex flex-row justify-between mx-auto max-w-6xl">
                <h1> <a class="px-6 rounded-lg hover:bg-gray-600" href="#">Admin Pok√©dex</a></h1>
                <a class="px-6 rounded-lg hover:bg-gray-600" href="../">Retourner √† l'accueil</a>
            </div>
        </div>
    </header>
    <main>
        <div class="py-10 px-6 mx-auto max-w-6xl">
            <a class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700" href="addJaquette.html">Ajouter une nouvelle jaquette</a>
            
        </div>
        <div class="py-3 px-6 mx-auto max-w-6xl">
        <table class="min-w-full bg-white border border-gray-300 text-sm text-left">
            <thead class="bg-gray-200">
              <tr>
                <th class="py-2 px-4 border-b">Nom du jeu</th>
                <th class="py-2 px-4 border-b">Nom du fichier</th>
                <th class="py-2 px-4 border-b">Aper√ßu</th>
                <th class="py-2 px-4 border-b">Actions</th>
              </tr>
            </thead>
            <tbody id="crudTableBody">
              <!-- Les lignes du tableau seront ins√©r√©es ici dynamiquement -->
            </tbody>
          </table>
        </div>
    </main>


    <script>
        async function loadJaquettes() {
          try {
            const response = await fetch('/api/jaquettes');
            if (!response.ok) throw new Error("Impossible de charger les jaquettes");
      
            const data = await response.json();
            const tbody = document.getElementById('crudTableBody');
      
            data.forEach(entry => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td class="py-2 px-4 border-b">${entry.game}</td>
                <td class="py-2 px-4 border-b">${entry.filename}</td>
                <td class="py-2 px-4 border-b"><img src="${entry.url}" alt="${entry.game}" class="h-12"></td>
                <td class="py-2 px-4 border-b">
                  <button class="text-red-600 hover:underline" onclick="deleteJaquette('${entry.filename}', this)">
                    üóë Supprimer
                  </button>
                </td>
              `;
              tbody.appendChild(tr);
            });
          } catch (err) {
            console.error('Erreur chargement des jaquettes:', err);
          }
        }
      
        async function deleteJaquette(filename, btn) {
          const confirmDelete = confirm("Supprimer cette jaquette ?");
          if (!confirmDelete) return;
      
          try {
            const res = await fetch(`/api/jaquettes/${filename}`, { method: 'DELETE' });
            if (res.ok) {
              btn.closest('tr').remove();
            } else {
              alert("√âchec de la suppression");
            }
          } catch (e) {
            alert("Erreur r√©seau : " + e.message);
          }
        }
      
        window.addEventListener('DOMContentLoaded', loadJaquettes);
      </script>
      
</body>
</html>